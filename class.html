<html lang="ru">
	<head>
		<meta charset="UTF-8" />
		<link rel="apple-touch-icon" sizes="180x180" href="assets/favicon/apple-touch-icon.png">
        <link rel="icon" type="image/png" sizes="32x32" href="assets/favicon/favicon-32x32.png">
        <link rel="icon" type="image/png" sizes="16x16" href="assets/favicon/favicon-16x16.png">
        <link rel="manifest" href="assets/favicon/site.webmanifest">
		<meta name="viewport" content="width=device-width, user-scalable=no initial-scale=1.0"/>
		<title>LiClick</title>
        <script src="https://telegram.org/js/telegram-web-app.js"></script>
		<link rel="stylesheet" href="assets/css/style.css">
	</head>
	<body class="bg-secondary">
        <div class="headers">
            <span class="clan-name">Мой класс</span>
        </div>
        <div class="leaderboard"></div>
        <script>
            const app = Telegram.WebApp;
            app.ready();
            app.expand();
            app.enableClosingConfirmation()
            app.BackButton.show();
            app.BackButton.onClick(function() {
                app.BackButton.hide();
                history.back()
            });
            app.enableClosingConfirmation();
            let leaderboard = document.querySelector('.leaderboard');
            let clan_name = '';

            function start(){
                fetch('https://api.lyclick.lc12.ru/clan', {
                    method: 'POST',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(app.initDataUnsafe)
                })
                .then(response => response.json())
                .then(response => {
                    
                    if (response.invite == 'yes'){
                        
                        for (clan of response.clans){
                            console.log(clan)
                            let tableRow = document.createElement("div");
                            tableRow.classList.add("table-row");
                            tableRow.innerHTML = '<div class="l-container"><span>'+clan.clan_name+'</span></div><div class="l-score"><button type="button" class="btn" value="'+clan.clan_name+'" onclick="btn_click(this)">Вступить</button></div>';
                            leaderboard.appendChild(tableRow);
                        }
                    }
                    else{
                        for (clan of response.clans){
                            console.log('else');
                            let tableRow = document.createElement("div");
                            tableRow.classList.add("table-row");
                            tableRow.innerHTML = '<div class="l-container"><span class="l-username">'+clan.username+'</span><span class="l-rank">'+clan.rank+'</span></div><div class="l-score">'+clan.score+'</div>';
                            leaderboard.appendChild(tableRow);
                        }
                    }
                });
            }

            start()
            function btn_click(clan){
                console.log(clan.value)
            }
            
        </script>
	</body>
</html>